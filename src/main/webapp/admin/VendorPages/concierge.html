

<html>
     
<head>

   
    
    <style>
        .myform{
    display:none;
}
    </style>
    <style>
         #main {
            display: flex;
            /* flex-direction: column;
            margin-top: 1%;
            justify-content: center;
            align-items: center; */
            width: 80%;
            height:100%
        }
 
        #rowAdder {
            margin-left: 17px;
        }
    </style>
    
    
   
    
</head>
<body>
        <div class="row" style="height:100%;">
            <div class="col">
                <div class="shadow-lg ">
                   <div class="col-12 p-2 bg-white no-print"  >
                    <span style="color: #f05f40">*</span><span>Mandatory Fields</span>
                     <h5 class=" font-14 text-center" style="color:green" id="msg"></h5></div>
                    <div class="text-light bg-danger text-center shadow-lg">Concierge Form</div>
  
  <div class="container"  style="height:100%;">
    <div class="row mb-4">
      <div class="col-sm-4">
        <h4>Concierge</h4>
        <select name="concierge" class="countries form-control" onChange="conciergeChange()" id="concierge">
      <option value="">Select Concierge</option>
       <option value="1">Taxi</option>
        <option value="2">Value Added</option>
  </select>

      </div>
      <div class="col-sm-4">
        <h4>Station</h4>
        <select name="StationId" class="states form-control" onChange="stationChange()" id="StationId">
      <option value="">Select Station</option>
  </select>
      </div>
    
    </div>
    
    
    <div class="row">
      <div id="main"> 
      <form method="post" name="conciergeForm" id="conciergeForm">
      <div id="formid" class="myform  px-3 mx-3 "  style="height:80%;">
      
       <div class="row" id="onegroup">
                         
                       
                <table class="table">
                <thead>
                    <tr  class="headRow">
                        <th>Slab</th>
                        <th>Car Type</th>
                        <th>AC /NonAC </th>
                          <th>Fare</th>
                    </tr>
                </thead>
                <tbody id="dynamicallyadd">
                    <tr>
                        <td><input type="text" class="form-control" id="slab" name="slab" placeholder="please enter input" required >
                        </td>
                        <td><select id="carTypeId" name="carTypeId" class="form-control" required>
                        </select></td>
                        <td> <select id="acNonacId" name="acNonacId" class="form-control" required> </select> </td>
                          <td> <input type="number" class="form-control" id="fare" name="fare" placeholder="please enter input" required >
                        
                       </td>
                         <td><button type="button" id="rowAdder" class="btn btn-success">+</button></td>
                    </tr>
                </tbody>
            </table>
            
             <div class="text-center mb-1"><input type="submit" value="Submit" class="btn btn-primary"></div>
 </div>
 </div>
 </form>
 </div>
</div>
 </div>

  </div>
  </div>
</div>
   </div>
   </div>
   </div>


</body>
<script>
var carTypelist ="";
var acNonAc ="";
var StationElement="";
function conciergeChange() {
	
	findUniqueIslsForVendor();
	//alert("changed");
	//findUniqueIslsForVendor();
}

function stationChange(){
	
	  var id=$('#StationId option:selected').attr('id');
	  StationElement = document.getElementById('StationId').value;
	  $(formid).show();
	  taxiCarTypeList();
      acNonacList();
}



var i = 1;
$('#rowAdder').click(() => {
	 i++;
    $('#dynamicallyadd').append(
        '<tr id="row' + i + '">' +
        
        '<td><input type="text" class="form-control" id="slab" name="slab" placeholder="please enter input" required ></td>'+
       ' <td><select id="carTypeId"  name="carTypeId" class="form-control carTypeId"  required> </select></td>'+
       ' <td> <select id="acNonacId" name="acNonacId" class="form-control acNonacId"  required> </select> </td>'+
       '<td> <input type="text" class="form-control" id="fare" name="fare" placeholder="please enter input" required ></td>'+
        '<td><button type="button" id="' + i + '" class="btn btn-danger remove_row">-</button></td>' +
        '</tr>');
    var carTypelist1=JSON.parse(carTypelist);
	 $('.carTypeId').empty();
	    $('.carTypeId').append($('<option></option>').val("").html("---select---"));
	    $.each(carTypelist1, function(i, p) {
	     $('.carTypeId').append($('<option></option>').val(p.id).html(p.carType)); 
	    });
	    
	 var acNonAclist=JSON.parse(acNonAc);
		 $('.acNonacId').empty();
		    $('.acNonacId').append($('<option></option>').val("").html("---select---"));
		    $.each(acNonAclist, function(i, p) {
		     $('.acNonacId').append($('<option></option>').val(p.id).html(p.acNonacType)); 
		    });
});
$(document).on('click', '.remove_row', function () {
    var row_id = $(this).attr("id");
    $('#row' + row_id + '').remove();
});

 
  $("#conciergeForm").submit(function (e) {
       
      //  alert("hello");
        var trainNoId = [];
        e.preventDefault();
        accesstoken = sessionStorage.getItem('key');
       
        var form = document.querySelector('#conciergeForm');
        var formData = new FormData(form);
        var data = $('tr:not(.headRow').map(function() {
        var obj = {};
        $(this).find('input,select').each(function() {
        	if( this.name=="carTypeId" || this.name=="acNonacId" || this.name=="fare")
        		{
        		 obj[this.name] =parseInt( $(this).val());
        		}
        	else{
        		obj[this.name] = $(this).val();
        	}
        	});
            return obj;
        }).get();
    //alert(JSON.stringify(data));
    alert(JSON.stringify({"serviceId":1,"subServiceId":1,"stationId":parseInt(StationElement),"taxiDetailsList":data}));
   // commonpostmethod("http://203.176.113.183/VendorAppServices/vendor/data/taxidetails",JSON.stringify({"serviceId":1,"subServiceId":1,"stationId":parseInt(StationElement),"taxiDetailsList":data})).then((response)=>{
	
    	 commonpostmethod("http://203.176.113.183/VendorAppServices/vendor/savetaxidetails",JSON.stringify({"stationId":parseInt(StationElement),"taxiDetailsModelList":data})).then((response)=>{
    			
    	
    	$("#msg").html( response.message);
     //document.getElementById("mappingForm").reset();
}).fail((xhr,status)=>{
	
	 if (xhr.status == '401') 
	 {                             //// $("#msg").html("Error :" +xhr.status+ "");
     
        refreshToken().then((res) => {
         	console.log(res);
         	setSessionStorageItems(res);
           $("#conciergeForm").submit();
            });
      }
	 else{
		 alert("some internal error occurred");
		 }
});    	
    
    document.getElementById("conciergeForm").reset();  
    $(formid).remove();
   /*  $(formid).hide(); */
    });


  //async
  function acNonacList(){	
     var accesstoken = sessionStorage.getItem('key');
   // response=await commongetmethoderrorhandling("http://203.176.113.183/VendorAppServices/vendor/acNonacList");
    response= commongetmethod("http://203.176.113.183/VendorAppServices/vendor/acNonacList").then((response)=>{
    	  acNonAc=JSON.stringify(response);//acNonAc
    	   //console.log(JSON.stringify(response));
    	    $('#acNonacId').empty();
    	    $('#acNonacId').append($('<option></option>').val("").html("---select---"));
    	    $.each(response, function(i, p) {
    	    $('#acNonacId').append($('<option></option>').val(p.id).html(p.acNonacType)); 
    	    });	
    	
    }) .fail((xhr,status)=>{
    	
   	 if (xhr.status == '401') {
          refreshToken().then((res) => {
             	console.log(res);
             	setSessionStorageItems(res);
             	 acNonacList();
                });
       }
   	 else{
   		 alert("some internal error occurred");
   		 }
   });
  
    }
 
 
  //async 
  function taxiCarTypeList(){	                                    
     var accesstoken = sessionStorage.getItem('key');
  // response=await commongetmethoderrorhandling("http://203.176.113.183/VendorAppServices/vendor/taxiCarTypeList");
   response= commongetmethod("http://203.176.113.183/VendorAppServices/vendor/taxiCarTypeList").then((response)=>{
	   carTypelist=JSON.stringify(response);
	   //console.log(JSON.stringify(response));
	     $('#carTypeId').empty();
	     $('#carTypeId').append($('<option></option>').val("").html("---select---"));
	     $.each(response, function(i, p) {
	     $('#carTypeId').append($('<option></option>').val(p.id).html(p.carType)); 
	     });   
   }) .fail((xhr,status)=>{
		
		 if (xhr.status == '401') {
	          refreshToken().then((res) => {
	          	console.log(res);
	          	setSessionStorageItems(res);
	          	 taxiCarTypeList();
	             });
	    }
		 else{
			 alert("some internal error occurred");
			 }
	});
 }

// async
function findUniqueIslsForVendor(){	
    var accesstoken = sessionStorage.getItem('key');
     commongetmethod("http://203.176.113.183/VendorAppServices/vendor/findUniqueIslsForVendor").then((response)=>{
    	 
    	   // console.log(JSON.stringify(response));
    	    $('#StationId').empty();
    	    $('#StationId').append($('<option></option>').val("").html("---select---"));
    	    $.each(response, function(i, p) {
    	    $('#StationId').append($('<option></option>').val(p.id).html(p.name)); 
    	    });
     })
     .fail((xhr,status)=>{
	
	 if (xhr.status == '401') {
          refreshToken().then((res) => {
          	console.log(res);
          	setSessionStorageItems(res);
          	findUniqueIslsForVendor();
             });
    }
	 else{
		 alert("some internal error occurred");
		 }
});
   }



</script>
</html>