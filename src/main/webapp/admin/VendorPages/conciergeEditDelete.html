<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <style>
         .myform{
    display:none;
}
   </style>
</head>

<body>
      <h5 class=" font-14 text-center  " id="succesmsg" style="color:green"></h5>
       <h5 class=" font-14 text-center  " id="errormsg" style="color:red"></h5>
    <div class="container text-center bg-danger text-light my-1 ">
         
        <strong>Concierge Modification Services</strong>
    </div>
    <div class="container">
    <div class="row mb-4">
      <div class="col-sm-4">
        <h4>Concierge</h4>
        <select name="concierge" class="countries form-control" onChange="conciergeChange()" id="concierge">
        <option value="">Select Concierge</option>
        <option value="1">Taxi</option>
        <option value="2">Value Added</option></select>

      </div>
      <div class="col-sm-4">
        <h4>Station</h4>
        <select name="StationId" class="states form-control" onChange="stationChange()" id="StationId">
      <option value="">Select Station</option>
  </select>
      </div>
    
    </div>
    
    
        <form  method="post" name="ConciergeForm" id="ConciergeForm">
        <div id="formid" class="myform  px-3 mx-3 "  style="height:80%;">
           <!--  <table class="table">
                <thead>
                    <tr class="headRow">
                        <th>Slab</th>
                        <th>Car Type</th>
                        <th>AC/NonAC</th>
                        <th>Fare</th>
                    </tr>
                </thead>
                <tbody id="dynamicallyadd">
                    <tr>
                        <td><input type="text" class="form-control" id="slab" name="slab" placeholder="please enter input" required ></td>
                        <td><select id="carTypeId" name="carTypeId" class="form-control" required></select></td>
                        <td><select id="acNonacId" name="acNonacId" class="form-control" required> </select></td>
                        <td> <input type="number" class="form-control" id="fare" name="fare" placeholder="please enter input" required ></td>
                        <td><button type="button" id="edit" class="btn btn-success">Edit</button></td>
                        <td><button type="button" id="delete" class="btn bg-danger">Delete</button></td>
                    </tr>
                </tbody>
            </table> -->
            
<div class="row">
<table id="tableID" class="display" style="width:100%">
<thead>
    <tr>
        <th>Taxi Details Id</th>
        <th>Vendor Service Id</th>
        <th>Slab </th>
        <th>Car Type</th>
        <th>Ac/NonAc</th>
         <th>Fare</th>
        <th>Isl Id</th>
       
    </tr>
</thead>
<tbody id="tbodyid">

           
</tbody>

</table>
</div>
  <!--   <div class="text-center"><input type="submit" value="Submit" class="btn btn-primary"></div> -->
          </div>
        </form>
    </div>
</body>
<script>
function conciergeChange() {
	
	findUniqueIslsForVendor();
	
}

function stationChange(){
	
	  var id=$('#StationId option:selected').attr('id');
	  StationElement = document.getElementById('StationId').value;
	  $(formid).show();
	  taxiCarTypeList();
      acNonacList();
	  // $('#tableID').DataTable({ });
      gettaxidetails();
      
}


function gettaxidetails(){	
    var accesstoken = sessionStorage.getItem('key');
   response= commongetmethod("http://203.176.113.183/VendorAppServices/vendor/data/gettaxidetails/98").then((response)=>{
   //acNonAc=JSON.stringify(response);//acNonAc
   	   console.log(JSON.stringify(response));
   alert("gettaxidetails ::::: "+response+response.length);
   var tbodyHtml ='';
   	for(i=0;i<response.length;i++){
   	 tbodyHtml+="<tr>"
       /*  tbodyHtml+="<td>"+response[i].taxiDetailsId+" </td>"+
        "<td>"+response[i].vendorServiceId+" </td>"+
        "<td>"+response[i].slab+" </td>"+
        "<td>"+response[i].carType+" </td>"+
        "<td>"+response[i].acNonAcType+" </td>"+
        "<td>"+response[i].fare+" </td>"+
        "<td>"+response[i].islId+" </td>"+ */
        tbodyHtml+='<td><input type="number" class="form-control" id="taxiDetailsId" name="taxiDetailsId" value="'+response[i].taxiDetailsId+'" required ></td>'+
        
        '<td><input type="number" class="form-control" id="vendorServiceId" name="vendorServiceId" value="'+response[i].vendorServiceId+'"required ></td>'+
        '<td><input type="text" class="form-control" id="slab" name="slab" value="'+response[i].slab+'"required ></td>'+
        '<td><input type="text" class="form-control" id="carType" name="carType" value="'+response[i].carType+'"required ></td>'+
        '<td><input type="text" class="form-control" id="acNonAcType" name="acNonAcType" value="'+response[i].acNonAcType+'"required ></td>'+
        '<td><input type="number" class="form-control" id="fare" name="fare" value="'+response[i].fare+'"required ></td>'+
        '<td><input type="number" class="form-control" id="islId" name="islId" value="'+response[i].islId+'"required ></td>'+

        
        '<td><button type="button" id="edit" class="btn btn-success" onclick="gettaxidetailsEdit()">Edit</button></td>'+
        '<td><button type="button" id="edit" class="btn bg-danger" onclick="gettaxidetailsDelete()">Delete</button></td>'+
        
        "</tr>";
                 
        }
$("#tbodyid").html(tbodyHtml);
   
  // alert(tbodyHtml);
   
   	 
   }) .fail((xhr,status)=>{
   	
  	 if (xhr.status == '401') {
         refreshToken().then((res) => {
            	console.log(res);
            	setSessionStorageItems(res);
            	gettaxidetails();
               });
      }
  	 else{
  		 alert("some internal error occurred");
  		 }
  });
 
   }

function gettaxidetailsEdit(){
	
	  var form = document.querySelector('#conciergeForm');
      var formData = new FormData(form);
      var data = $('tr:not(.headRow').map(function() {
      var obj = {};
      $(this).find('input,select').each(function() {
      	if( this.name=="carTypeId" || this.name=="acNonacId" )
      		{
      		 obj[this.name] =parseInt( $(this).val());
      		}
      	else{
      		obj[this.name] = $(this).val();
      	}
      	});
          return obj;
      }).get();
	
	
	alert("gettaxidetailsEdit");
	
}




function acNonacList(){	
    var accesstoken = sessionStorage.getItem('key');
  // response=await commongetmethoderrorhandling("http://203.176.113.183/VendorAppServices/vendor/acNonacList");
   response= commongetmethod("http://203.176.113.183/VendorAppServices/vendor/acNonacList").then((response)=>{
   	  acNonAc=JSON.stringify(response);//acNonAc
   	   //console.log(JSON.stringify(response));
   	    $('#acNonacId').empty();
   	    $('#acNonacId').append($('<option></option>').val("").html("---select---"));
   	    $.each(response, function(i, p) {
   	    $('#acNonacId').append($('<option></option>').val(p.id).html(p.acNonacType)); 
   	    });	
   	
   }) .fail((xhr,status)=>{
   	
  	 if (xhr.status == '401') {
         refreshToken().then((res) => {
            	console.log(res);
            	setSessionStorageItems(res);
            	 acNonacList();
               });
      }
  	 else{
  		 alert("some internal error occurred");
  		 }
  });
 
   }


 //async 
 function taxiCarTypeList(){	                                    
    var accesstoken = sessionStorage.getItem('key');
 // response=await commongetmethoderrorhandling("http://203.176.113.183/VendorAppServices/vendor/taxiCarTypeList");
  response= commongetmethod("http://203.176.113.183/VendorAppServices/vendor/taxiCarTypeList").then((response)=>{
	   carTypelist=JSON.stringify(response);
	   //console.log(JSON.stringify(response));
	     $('#carTypeId').empty();
	     $('#carTypeId').append($('<option></option>').val("").html("---select---"));
	     $.each(response, function(i, p) {
	     $('#carTypeId').append($('<option></option>').val(p.id).html(p.carType)); 
	     });   
  }) .fail((xhr,status)=>{
		
		 if (xhr.status == '401') {
	          refreshToken().then((res) => {
	          	console.log(res);
	          	setSessionStorageItems(res);
	          	 taxiCarTypeList();
	             });
	    }
		 else{
			 alert("some internal error occurred");
			 }
	});
}

//async
function findUniqueIslsForVendor(){	
   var accesstoken = sessionStorage.getItem('key');
    commongetmethod("http://203.176.113.183/VendorAppServices/vendor/findUniqueIslsForVendor").then((response)=>{
   	 
   	   // console.log(JSON.stringify(response));
   	    $('#StationId').empty();
   	    $('#StationId').append($('<option></option>').val("").html("---select---"));
   	    $.each(response, function(i, p) {
   	    $('#StationId').append($('<option></option>').val(p.id).html(p.name)); 
   	    });
    })
    .fail((xhr,status)=>{
	
	 if (xhr.status == '401') {
         refreshToken().then((res) => {
         	console.log(res);
         	setSessionStorageItems(res);
         	findUniqueIslsForVendor();
            });
   }
	 else{
		 alert("some internal error occurred");
		 }
});
  }



</script>
</html>