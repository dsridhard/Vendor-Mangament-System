<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
 <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>

<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/js/bootstrap-multiselect.js"></script>  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/css/bootstrap-multiselect.css">  

<script src="assest/js/commonJs.js"></script>

</head>

<script>
    $(document).ready(() => {
      $('#header').load('header.html')
    
      $('#footer').load('footer.html')
    });
  </script>

<script>
$(document).ready(function (e){
	var username=sessionStorage.getItem('username');
	checksession();
	 fetchbasicdetails();// response
	



	
//alert(username);


 function fetchbasicdetails()
	  {
		  var accesstoken = sessionStorage.getItem('key');

			alert("accesstoken1"+accesstoken);
			   $.ajax( {
						  url: "http://203.176.113.183/VendorAppServices/divisional/userdetails/"+username,
						  method: "GET",
						  timeout: 0,
						  headers: {
						    "Authorization": "Bearer "+accesstoken
						  },
			    success: function(response){
				console.log(JSON.stringify(response));
				$("#welcomeP").html("Welcome "+username+" Zone: "+response.zoneName+" Division: "+response.divName);
				    vendorcategorylist(); /// wait
					vendorconstitutionlist();
					 trainlist(); 
				
				
			},
			 error:function(xhr,status){
				if(xhr.status=='401'){
					alert("access denied, please refresh the page again fachebasicdetails");
					refreshToken();
					fetchbasicdetails();
					 
					}
			}  
			});
			   
			   
			
			// return accesstoken;  

  }




  function  commongetmoethod(url)
  {
	  var accesstoken = sessionStorage.getItem('key');

	  $.ajax( {
		  url: url,
		  method: "GET",
		  timeout: 0,
		  headers: {
		    "Authorization": "Bearer "+accesstoken
		  },
success: function(response){
	return reponse

},
error:function(xhr,status){
if(xhr.status=='401'){
	alert("access denied, please refresh the page again ");
	refreshToken();
	common(url);
	}
}  
});
	  
  }
  
  
  
  function  commonpostmoethod(url)
  {
	  var accesstoken = sessionStorage.getItem('key');

	  $.ajax( {
		  url: url,
		  method: "POST",
		  timeout: 0,
		  headers: {
		    "Authorization": "Bearer "+accesstoken
		  },
		  "data": {
			    "username":username ,
			    "password": password,
			    "grant_type": "password",
			    "userLoginType": "DIVISIONAL"
			  },
success: function(response){
	return reponse

},
error:function(xhr,status){
if(xhr.status=='401'){
	alert("access denied, please refresh the page again 8ii");
	refreshToken();
	common(url);
	}
}  
});
	  
  }
  
	
	
$("#logoutlink").on("click",function(){
	
	sessionStorage.clear();
	 $(location).attr('href', window.location.pathname.substring(0, window.location.pathname.indexOf("/",2))+'/index.html');	
		
	
});
	
 
function vendorcategorylist(){
	
var accesstoken = sessionStorage.getItem('key');
 alert("vendorcategorylist "+accesstoken);

$.ajax( {
	  url: "http://203.176.113.183/VendorAppServices/divisional/vendorcategorylist",
	  method: "GET",
	  timeout: 0,
	  headers: {
	    "Authorization": "Bearer "+accesstoken
	  },
success: function(response){
console.log(JSON.stringify(response));
$('#vendorCategoryId').empty();
$('#vendorCategoryId').append($('<option></option>').val("").html("---select---"));

$.each(response, function(i, p) {

$('#vendorCategoryId').append($('<option></option>').val(p.id).html(p.categoryName));
});	
//$("#welcomeP").html("Welcome "+username+" Zone: "+response.zoneName+" Division: "+response.divName);

},
 error:function(xhr,status){
if(xhr.status=='401'){
	console.log("test5");
	//alert("ffff"+vendorcategorylist);
//	refreshToken();
//	fetchbasicdetails();
	//vendorcategorylist();
}

} 
});

}

function vendorconstitutionlist(){
	
	var accesstoken = sessionStorage.getItem('key');
	alert("vendorconstitutionlist "+accesstoken);
$.ajax( {
	  url: "http://203.176.113.183/VendorAppServices/divisional/vendorconstitutionlist",
	  method: "GET",
	  timeout: 0,
	  headers: {
	    "Authorization": "Bearer "+accesstoken
	  },
success: function(response){
console.log(JSON.stringify(response));
$('#vendorConstitutionId').empty();
$('#vendorConstitutionId').append($('<option></option>').val("").html("---Select---"));

$.each(response, function(i, p) {

$('#vendorConstitutionId').append($('<option></option>').val(p.id).html(p.constitutionName));
});	
//$("#welcomeP").html("Welcome "+username+" Zone: "+response.zoneName+" Division: "+response.divName);

},
  error:function(xhr,status){
if(xhr.status=='401'){
	console.log("test6");
//alert("access denied, please refresh the page again vendorconstitutionlist ");
//refreshToken();
//fetchbasicdetails();
//vendorconstitutionlist();


}

}  

});
}
 

function trainlist(){
	
var accesstoken = sessionStorage.getItem('key');
alert("trainlist "+accesstoken);
	  $.ajax( {
		  url: "http://203.176.113.183/VendorAppServices/divisional/trainlist",
		  method: "GET",
		  timeout: 0,
		  headers: {
		    "Authorization": "Bearer "+accesstoken
		  },
success: function(response){
console.log(JSON.stringify(response));
$('#trainsId').empty();
/* $('#trainlistapi').append($('<option></option>').val("").html("---select---")); */

$.each(response, function(i, p) {

    $('#trainsId').append($('<option></option>').val(p.trainNo).html(p.trainNo+" - "+p.trainName));
    $('#trainsId').multiselect('rebuild');
});	

//$("#welcomeP").html("Welcome "+username+" Zone: "+response.zoneName+" Division: "+response.divName);

},
 error:function(xhr,status){
if(xhr.status=='401'){
//alert("access denied, please refresh the page again trainlist");
//refreshToken();
//fetchbasicdetails();
//trainlist();

	}
}

	});
	  
}	 

$('#trainsId').multiselect(
				{
					includeSelectAllOption: true,
					 enableFiltering: true,
			          
				});  






$("#vendorRegistrationForm").submit(function(e){
	  
	//alert("hello");
	var nameofvendor = $('#firstName').val();
	alert(nameofvendor);
	var trainNoId=[];
		e.preventDefault();
		 accesstoken = sessionStorage.getItem('key');
		 var serializedReturn = $(this).serializeArray(); 
		//console.log("/////"+serializedReturn);
		 var train=$("#trainsId").val();
          alert("train"+train);
                for(var k=0;k<train.length;k++){

trainNoId[k]=parseInt(train[k]);
                    }
console.log(trainNoId);
			
		 var loginFormObject = {};
		 $.each(serializedReturn,
		     function(i, v) {
		         loginFormObject[v.name] = v.value;
		     });
		 loginFormObject["trainsId"]=trainNoId;
	     //console.log(JSON.stringify(loginFormObject));
		  $.ajax( {
			  url: "http://203.176.113.183/VendorAppServices/divisional/registernewvendor",
			  method: "POST",
			
			  headers: {
			    "Authorization": "Bearer "+accesstoken,
			    "Content-Type": "application/json"
			  },
			  data: JSON.stringify(loginFormObject),
	success: function(response){
		alert("successfully register");
		alert(response.message);
	//$("#welcomeP").html("Welcome "+username+" Zone: "+response.zoneName+" Division: "+response.divName);

	},
	error:function(xhr,status){
	if(xhr.status=='401'){

	alert("access denied, please refresh the page again");
	refreshToken();
		}

	},
	
	
	

		});


		
		
  });


	
});





</script>


<body id="maindashboard">
 <header id="header"></header>
<div class="ajax-loader" 
style="display:none">
<!-- <img src='../images/ajax-loader.gif'  /> -->
<br>Loading..</div> 
<div class="row customheight m-0 h-100"  >
<div class="col-12 p-2 bg-white h-100 no-print"  >
     	

			<h5 class=" font-14 text-center" id="welcomeP"></h5>
			
		<a href="#" id="logoutlink">
<button class="btn btn-sm float-right custombtnnew btn-info " >Logout</button>
</a>


	</div>
	<div class="col-1-5 p-0 h-100 sidebarbg no-print" id="sidebarHTML" style="overflow:auto" >
		

		
		</div>
		<div class="col-10-5 p-0"  style="background-color:white;">
		<!--    header end   -->
		
		<div class="row m-0 "  >
	
</div>
		
		<div class="row m-0 p-2 ml-2 dashboardmainsection custom-height-main-content" style="background-color:#f4f6f9;overflow:auto"  id="dashboardmainsection">
		<form  method="post" id="vendorRegistrationForm" name="vendorRegistrationForm">
                <div class="note">
                   <p> Vendor Registration Form </p>
                </div>
  <div class="form-row">
    <div class="form-group col-md-6">
      <label for="inputnameofvendor">First Name</label>
      <input type="text" class="form-control" id="firstName" name="firstName" placeholder="Name of Vendor" >
    </div>
    
     <div class="form-group col-md-6">
       <div class="form-group col-md-6">
      <label for="inputnameofvendor">Last Name</label>
      <input type="text" class="form-control" id="lastName" name="lastName" placeholder="Name of Vendor" >
    </div>
    </div>
    
  </div>
  <div class="form-row">
   <div class="form-group col-md-6">
      <label for="inputconstitution">Constitution of the Vendor</label>
      <div class="dropdown">
      <select id="vendorConstitutionId" name="vendorConstitutionId" class="form-control">
      </select>
      </div>
    </div>
        <div class="form-group col-md-6">
      <label for="inputpanoftheBusiness">Vendor HSN Code</label>
      <input type="text" class="form-control" id="vendorHsnCode" name="vendorHsnCode" placeholder="" >
    </div>
    </div>
  
   <div class="form-row">
    <div class="form-group col-md-6">
      <label for="inputpanoftheBusiness">Pan of the Business</label>
      <input type="text" class="form-control" id="vendorPan" name="vendorPan" placeholder="" >
    </div>
    
    
      <div class="form-group col-md-6">
      <label for="inputDetailsofgoods"> Details of Goods</label>
      <input type="text" class="form-control" id="goodsDetails" name="goodsDetails" placeholder="" >
    </div> 
  </div>
  
  <div class="form-row">
   <!--  <div class="form-group col-md-6">
      <label for="inputdetailsofservice">Details of service</label>
      <input type="text" class="form-control" id="detailsofservice" name="detailsofservice" placeholder="" >
    </div> -->
    
    
      <div class="form-group col-md-6">
      <label for="inputcategoryofvendor">Category of Vendor </label>
      <select id="vendorCategoryId" name="vendorCategoryId" class="form-control" >
      </select>
    </div>
    
    
  </div>


    <div class="form-row">
    <div class="form-group col-md-6">
      <label for="inputtrainlistapi">Train Number</label>
      <select id="trainsId" name="trainsId" class="form-control"  multiple="multiple">
      </select>
    </div>
    
    <div class="form-group col-md-6">
      
    </div>
  </div>
  
  <div class="form-group">
    <label for="inputAddress">Address</label>
    <input type="text" class="form-control" id="address"  name="address" placeholder="please enter address ">
  </div>
 
  
  <div class="form-row">
    <div class="form-group col-md-6">
      <label for="inputcontactno">Latest Contact No.</label>
      <input type="number" class="form-control" id="contactNo" name="contactNo" >
    </div>
   
  </div>
  
   <div class="form-row">
    <div class="form-group col-md-6">
      <label for="inputemailId">Latest email-Id (if any)</label>
      <input type="email" class="form-control" id="email" name="email">
    </div>
    <div class="form-group col-md-6">
      <label for="inputgstinBygov">GSTIN alloted by the Govt</label>
      <input type="text" class="form-control" id="gstin" name="gstin">
    </div>
  </div>
  <div class="form-row">
      <label for="inputupiId">UPI ID</label>
      <input type="text" class="form-control" id="upiId" name="upiId">
   </div>
   
  <div class="form-row">
    <div class="form-group col-md-4">
      <label for="inputbankBranchName">Bank Name</label>
      <input type="text" class="form-control" id="bankName" name="bankName" >
    </div>
    <div class="form-group col-md-4">
      <label for="inputbankBranchName">Bank Branch</label>
      <input type="text" class="form-control" id="bankBranch" name="bankBranch" >
    </div>
    <div class="form-group col-md-4">
      <label for="inputbanAaccountNo">Bank Account Number</label>
      <input type="text" class="form-control" id="bankAccountNo" name="bankAccountNo" >
    </div>
  </div>
  
  
  <div class="form-row">
    <div class="form-group col-md-6">
      <label for="inputifscCodes">IFSC</label>
      <input type="text" class="form-control" id="bankIfsc" name="bankIfsc" >
    </div>
    <div class="form-group col-md-6">
      <label for="inputmicrNo">MICR</label>
      <input type="text" class="form-control" id="bankMicr" name="bankMicr" >
    </div>
  </div>
  
  
  <div>
        <button class="btn btn-lg btn-primary btn-block" type="submit"  >Submit</button>
 <!--  <button type="submit" class="btn btn-primary">Sign in</button> -->
 </div>
</form>
		</div>
	</div>
	</div>
	

 
  <footer class="footer" id="footer"></footer>
	
</body>
</html>